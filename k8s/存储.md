# 存储
POD使用`PVC`申请数据卷；k8s将`PV`与`PVC`进行绑定。
PVC 是使用PV资源的声明。
PV 是一种资源

PV类型：
- `static`: 静态，有系统管理元创建。
- `dynamic`: 动态，系统动态创建，满足`PVC`。`PV`的提供着是StorageClass。要使用动态供应，PVC必须要指定一个StorageClass。如果StorageClass设置为空，那么针对这个PVC的动态供应特性会被禁用。
 
回收机制：
- `Retain` 系统不会自动删除，需要管理员手动删除。
- `Delete` 系统会自动删除不再使用的PV。
- `Recycle`(已弃用)


`StorageClass`(SC)
`PersistentVolume` (PV)
`PersistentVolumnClaim`(PVC)
`Storage Provisioner Controller`

创建一个使用本地文件系统的PV
```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv001
  labels:
    name: local
spec:
  capacity:
  storage: 10Gi
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: manual
  hostPath:
    path: "/data/xsport/postgresql-data"
```

创建一个PCV，并与PC绑定
```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mypvc
  namespace: default
spec:
  accessModes: ["ReadWriteMany"]
  resources:
    requests:
      storage: 6Gi
```

如果在PVC中没有声明（或者省略掉了）storageClassName，那么就会使用默认的StorageClass。
但是在显示的声明storageClassName且值等于`""`, 那么将禁止使用动态供应（dynamic provisioning)，转而选择已经存在的存储卷(Volumn)并与其绑定。
如何将PVC绑定到特定的PV上？简单来讲，就是给PV打上一个label，然后让PVC去匹配这个label即可。

## 修改默认存储类

```bash
kubectl patch storageclass <your-class-name> -p '{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}'
```

## References
https://www.jianshu.com/p/b3665b72126e
https://wangwei1237.github.io/Kubernetes-in-Action-Second-Edition/docs/Dynamic_provisioning_of_persistent_volumes.html